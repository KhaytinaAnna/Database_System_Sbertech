# Starcounter DB

![image](https://github.com/KhaytinaAnna/Database_System_Sbertech/assets/71896956/52f0c6e9-369e-4e83-9107-2437cde92be3)


## История развития СУБД
Starcounter DB - это высокопроизводительная база данных, которая предназначена для веб-приложений и современных облачных сервисов. История развития Starcounter DB началась в 2006 году, когда Генрик Лифферт начал работать над созданием новой базы данных с упором на масштабируемость и быстродействие. Первая версия была представлена в 2011 году. Однако, с течением времени, продукт развивался и расширял свой функционал и возможности. В 2013 году была представлена версия, которая включала многие продвинутые функции, такие как масштабирование, инструменты разработки и управление транзакциями. С 2016 года Starcounter стал полностью бесплатной и открытой системой для крупного бизнеса. 

## Архитектура Starcounter

![image](https://github.com/KhaytinaAnna/Database_System_Sbertech/assets/71896956/bffcf984-7398-480f-b4c2-f67a628a9c9f)

На этой диаграмме показаны приложения Starcounter, работающие внутри базы данных и имеющие прямой доступ к объектам базы данных, сохраненным в оперативной памяти.
Обратного пути между базой данных и приложением нет. Классы приложений являются объектами базы данных.

## Инструменты для взаимодействия с СУБД
StarcounterDB - объектно-ориентироанная база данных, позволяет приложению и базе данных находиться в одном и том же пространстве виртуальной памяти. Поддерживает платформы Ubuntu, Windows. .NET Core 3.0.100 , SDK для разработки, среда выполнения для производства. К базе данных можно обращаться с помощью SQL-запросов. Серверный код написан с помощью C#, поэтому один из способов работы с Starcounter DB - это использование C# API. Можно работать в редакторе SQL Editor или веб-приложении Starcounter Data Studio. 

## Какой database engine используется в СУБД?
Starcounter Database Engine базируется на принципах хранения в оперативной памяти(не на диске) и транзакционной модели данных(она поддерживает соответствие ACID). Всякий раз, когда происходят изменения в базе данных, они сохраняются в хранилище транзакций. Это позволяет гарантировать целостность данных и предоставляет возможность работы с транзакциями, откатами, многопоточностью и репликацией данных, про которые подробней мы поговорим позже

## На каких языках написана СУБД? Как устроен язык запросов в СУБД?
Язык запросов StarcounterDB основан на C#(а также С и С++). Можно извлечь выгоду из использования объектного API Starcounter .NET, API «дает простой способ написания SQL-запросов, возвращающих настоящие объекты .NET. Это позволяет легко и эффективно комбинировать запросы к базе данных».

## Возможно ли распределение файлов БД по разным носителям?
Starcounter поддерживает многопоточность и репликацию данных. Многопоточность позволяет обрабатывать несколько запросов одновременно, что увеличивает производительность системы. Репликация данных позволяет сохранять несколько копий базы данных на разных узлах, что повышает отказоустойчивость системы и обеспечивает более надежное хранение данных. 
В доказательство, у starcounter существует конфигурационный параметр Filename, например:
```
CREATE DATABASE ExampleDatabase1 (FileName='D:\ExampleDatabase1.sdb');
CREATE DATABASE ExampleDatabase2 (FileName='C:\ExampleDatabase2.sdb');
```
То есть файлы можно разнести по разным носителям

## Какие типы индексов поддерживаются в БД?
Индексы базы данных могут быть определены с помощью SQL-запросов. Поддерживаются как уникальные, так и не уникальные индексы. Поскольку это оператор DDL, мы используем для его выполнения вне активной транзакции. Например, 
```
var ddlExecutor = services.GetRequiredService<IDdlExecutor>();
ddlExecutor.Execute("CREATE INDEX IX_Person_FirstName ON Person (FirstName)");
```

Для C# будет выглядеть так:

```
using System;
using Starcounter.Database;

[Database]
public abstract class Person
{
    [Index]
    public abstract string Name { get; set; }
}

```

## Как строится процесс выполнения запросов в СУБД?
Starcounter DB “собирает данные”, он сканирует in-memory таблицу. Далее происходит обработка собранных данных при помощи встроенного языка C#. Далее Starcounter DB формирует результаты запроса, они могут быть возвращены в виде объектов C# или в другом формате, в зависимости от типа запроса. Как только запрос выполнен успешно, Starcounter DB завершает транзакцию и сохраняет изменения в базе данных.  
Важно отметить, что Starcounter DB использует механизмы кэширования для увеличения производительности. Он хранит часто запрашиваемые данные в кэше, чтобы избежать лишних обращений к диску. Минусом in-memory базы данных является непостоянство оперативной памяти. В частности, в случае потери питания, данные теряются.

## Есть ли понятие “план запросов” в СУБД?
Да, такое понятие есть. План запроса может быть использован для анализа и оптимизации производительности запросов. Он может помочь в определении того, какие индексы и ключи следует использовать для ускорения запросов.
Чтобы получить план запроса для запроса, необходимо использовать метод Plan() при выполнении запроса в Starcounter DB. Например:
```
var plan = Db.SQL<MyTable>("SELECT * FROM Person WHERE Person.name = “Anna”).Plan();
```


## Поддерживаются ли транзакции в СУБД? Если нет, то есть ли альтернатива?
Starcounter использует транзакции базы данных, чтобы обеспечить соответствие операций базы данных ACID
### 1) Атомарность
Starcounter обеспечивает атомарность, заключая изменения одной транзакции в область транзакции. Изменения фиксируются одновременно в конце области действия. Если что-то прерывает транзакцию до того, как будет достигнут конец области, ни одно из изменений не будет зафиксировано в базе данных.
### 2) Последовательность
В Starcounter это решается путем создания исключений, когда в рамках транзакции выполняется недопустимое действие, например, передача неуникальных значений в поле, для которого требуются уникальные значения. Исключение, в свою очередь, заставит транзакцию откатиться, так что ни одно из изменений не будет применено.
### 3) Изоляция
Чтобы сделать транзакцию изолированной, Starcounter использует изоляцию моментальных снимков . Это означает, что когда транзакция инициализируется, она делает снимок базы данных и сохраняет его в транзакционной памяти. Каждая транзакция работает со своим снимком базы данных. Например, SQL-запрос, который выполняется до фиксации параллельной транзакции, не сможет увидеть изменения, сделанные транзакцией, поскольку эти изменения изолированы от моментального снимка этой транзакции в базе данных.
### 4) Долговечность
Долговечность гарантирует, что результаты совершенных транзакций будут постоянно записываться. Starcounter решает эту проблему, записывая транзакции в журнал транзакций после их фиксации.

Starcounter обрабатывает транзакции без блокировки измененных объектов. При наличии конфликтов можно использовать метод `ITransactor.TryTransact` для повторной попытки при возникновении конфликта (Он объявляет транзакционную область и выполняется синхронно, как описано выше). Пример создания новой транзакции:

```
var transactor = services.GetRequiredService<ITransactor>();
transactor.Transact(db =>
{
    var person = db.Insert<Person>(); // Adds a row to the Person table.
    person.Name = "Gandalf";
});

```

Так как ITransactor.Transact синхронный, он блокирует исполняемый поток до тех пор, пока транзакция не завершится. 

Есть асинхронный аналог ITransactor.TransactAsync. Это дает больше контроля над пропускной способностью и задержкой. Это полезно и при последовательном создании транзакций: ускоряет работу приложения (поток свободен для обработки следующей транзакции, даже если операции с базой данных в предыдущих транзакциях еще не записаны в журнал транзакций). Но есть свои риски… Например, если произошло отключение питания или другой аппаратный сбой после отправки электронного письма, но до записи в журнал, электронное письмо будет неправильным. Даже если пользователь получил подтверждение, заказ не будет в базе данных, так как он никогда не был записан в журнал транзакций.

## Расскажите о методах восстановления в СУБД
 1) Можно попробовать восстановить данные из журнала транзакций. Журнал содержит записи о всех изменениях, которые были сделаны в базе данных, и может быть использован для восстановления данных после сбоя.
 2) Восстановление из резервных копий. Необходимо остановить работу Starcounter и заменить текущие файлы базы данных файлами из резервного копирования.


## Расскажите про шардинг в вашей СУБД. Какие типы используются и принцип работы
Нашла не очень много информации насчет шардирования в StarcounterDB, но можно сказать, что необходимо учитывать особенности базы данных(транзакции, используя которые можно обеспечить согласованность данных между шардами). И также необходимо синхронизировать данные между серверами


## Возможно ли применить термины Data mining, Data Warehousing, OLAP в СУБД?
StarcounterDB предоставляет набор функций OLAP таких как агрегаты, сводные таблицы и анализ данных в режиме реального времени. Думаю, что Data Mining также можно применить к нашей базе данных, так как извлечение данных и их поиск вполне себе можно реализовать на языках программирования, на которых основана StarcounterDB(C#, C++, C)

## Как продолжить самостоятельное изучение языка запросов с помощью демобазы
Github демобазы: https://github.com/Starcounter/Constructor

## Где найти документацию, быть в курсе происходящего и пройти обучение?
Документация: 
https://docs.starcounter.io/

Техническое описание:
https://starcounter.com/wp-content/themes/starcounter-custom/assets/docs/Starcounter_Technical_Overview.pdf

GitHub: https://github.com/Starcounter
